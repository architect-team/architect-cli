TODO: make this look nice

## Creating remote infrastructure

TODO: note about required AWS permissions

Terraform templates for running the component in a remote environment can be found in the `terraform` directory. Ensure that [`terraform`](https://learn.hashicorp.com/tutorials/terraform/install-cli) is installed and that you have an AWS account, then follow the next steps.

First, navigate to the `terraform` folder in your terminal, then set the environment variables for your AWS credentials like so:

```sh
export AWS_ACCESS_KEY_ID=<aws_access_key>
export AWS_SECRET_ACCESS_KEY=<aws_secret_access_key>
export AWS_DEFAULT_REGION=<aws_region>
```

Next, create an AWS S3 bucket where the terraform remote state should be stored. Use it in the following command to initialize terraform:

```sh
terraform init -backend-config="bucket=<s3_bucket_name>" -backend-config="region=<aws_region>" -backend-config="key=<aws_access_key>"
```

Once terraform is initialized, some values will need to be set for the future infrastructure. Still in the `terraform` folder, create a file called `values.tfvars` and add the following contents:

```
prefix = "react-app"
postgres_user = "postgres"
postgres_password = "architect"
postgres_database = "test_database"
postgres_port = "5432"
```

These values can be changed but reasonable defaults have been provided. Next, plan the infrastructure by running the following in your terminal:

```sh
terraform plan -out tfplan -var-file values.tfvars
```

A list of resources to create will be displayed. Create the infrastructure by running the following:

```sh
terraform apply tfplan
```

This will take several minutes and once it's done, the message `Apply complete!` will be printed. Move on to the next section to learn how to run the Architect component on your new infrastructure.

TODO: note about creating kubeconfig because of new module version https://docs.aws.amazon.com/eks/latest/userguide/create-kubeconfig.html

## Automated deployments with GitHub workflows

A GitHub workflow is included in the `github` directory which contains a workflow to deploy the component automatically after a branch is merged to master. If you would like to use it to deploy the component automatically, move it to the folder `.github/workflows` in your own repo. The root of the repository should also contain the `architect.yml` file and the full `frontend` and `backend` directories. Be sure to add the following secrets on your GitHub repository's settings page:

* ARCHITECT_EMAIL
* ARCHITECT_PASSWORD (This will be a personal access token generated by you on the Architect Cloud.)
* ACCOUNT_NAME
* ENVIRONMENT_NAME
* POSTGRES_HOST (This was printed as an output if you've created your infrastructure with terraform and can also be found on your AWS dashboard)

Note that the name of the component, `examples/react-app`, should also be changed to `<your_account_name>/react-app` in the `architect.yml` file. The GitHub workflow also assumes that you've already created an Architect platform and environment. If you've used terraform to create your infrastructure, the Kubernetes config file to create your Architect platform will have been created in the same directory in which the `terraform` commands were run.
